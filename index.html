<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shooting Range</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>

    <div id="crosshair"></div>

    <canvas id="bg-canvas"></canvas>
    <canvas id="webgl"></canvas>

    <div id="scoreboard">
      <div class="hud-section score-section">
        <span class="hud-label">PTS</span>
        <span id="score">0</span>
      </div>
      <div class="hud-section timer-section">
        <div class="diamond-shape"></div>
        <div class="timer-content">
          <span id="time">30</span>
        </div>
      </div>
    </div>

    <div id="result-overlay">
      <div class="result-card">
        <h2>SESSION COMPLETE</h2>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-label">Time Played</span>
            <span class="stat-value" id="res-time">30s</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Targets Spawned</span>
            <span class="stat-value" id="res-spawn">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Targets Hit</span>
            <span class="stat-value" id="res-hit">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Shots Missed</span>
            <span class="stat-value" id="res-miss">0</span>
          </div>
          <div class="stat-item full-width">
            <span class="stat-label">Final Score</span>
            <span class="stat-value highlight" id="res-score">0</span>
          </div>
        </div>
        <button id="btn-result-back" class="btn btn-primary">Back to Menu</button>
      </div>
    </div>

    <div id="menu-overlay">
      <div class="menu-card">
        <h1>Aim Trainer</h1>
        <div id="main-menu">
          <button id="btn-play" class="btn btn-primary">Play</button>

          <!-- DIFFICULTY PRESET -->
          <div id="difficulty-presets" style="margin:8px 0; display:none;">
            <select id="difficulty-select" class="btn btn-secondary" style="width:100%;">
              <option value="easy">Easy</option>
              <option value="normal" selected>Normal</option>
              <option value="hard">Hard</option>
            </select>
          </div>

          <!-- DROPDOWN TIME -->
          <div id="time-presets" style="margin:8px 0; display:none;">
            <select id="time-select" class="btn btn-secondary" style="width:100%;">
              <option value="30" selected>30 Seconds</option>
              <option value="60">60 Seconds</option>
              <option value="90">90 Seconds</option>
            </select>
          </div>

          <div id="play-modes">
            <button class="btn mode-btn" onclick="selectMode('spidershot')">Spidershot</button>
            <button class="btn mode-btn" onclick="selectMode('motionshot')">Motionshot</button>
          </div>

          <button id="btn-back" class="btn btn-secondary" style="display:none;">Back</button>
          <button id="btn-practice" class="btn btn-secondary">Practice</button>
        </div>
      </div>
    </div>

    <div id="pause-overlay" style="display: none;">
      <div class="menu-card">
        <h1>PAUSED</h1>
        <button id="btn-resume" class="btn btn-primary">Resume</button>
        <button id="btn-restart" class="btn btn-secondary">Restart</button>
        <button id="btn-exit" class="btn btn-secondary">Exit to Menu</button>
      </div>
    </div>

    <div id="countdown">3</div>

    <script type="module" src="ball.js"></script>
    <script type="module" src="background.js"></script>

    <script>
      const btnPlay = document.getElementById("btn-play");
      const btnPractice = document.getElementById("btn-practice");
      const btnBack = document.getElementById("btn-back");
      const playModes = document.getElementById("play-modes");
      const timePresets = document.getElementById("time-presets");
      const timeSelect = document.getElementById("time-select");
      const difficultyPresets = document.getElementById("difficulty-presets");
      const difficultySelect = document.getElementById("difficulty-select");
      const countdownEl = document.getElementById("countdown");
      const menuOverlay = document.getElementById("menu-overlay");

      const pauseOverlay = document.getElementById("pause-overlay");
      const btnResume = document.getElementById("btn-resume");
      const btnRestart = document.getElementById("btn-restart");
      const btnExit = document.getElementById("btn-exit");

      let isPaused = false;
      let isGameActive = false;
      let activeMode = null;
      let selectedTime = 30;
      let selectedDifficulty = "normal";
      

      btnPlay.addEventListener("click", () => {
        playModes.classList.add("visible");
        timePresets.style.display = "block";
        difficultyPresets.style.display = "block";
        btnPlay.style.display = "none";
        btnPractice.style.display = "none";
        btnBack.style.display = "block";
      });

      btnBack.addEventListener("click", () => {
        playModes.classList.remove("visible");
        timePresets.style.display = "none";
        difficultyPresets.style.display = "none";
        btnPlay.style.display = "block";
        btnPractice.style.display = "block";
        btnBack.style.display = "none";
      });

      timeSelect.addEventListener("change", () => {
        selectedTime = parseInt(timeSelect.value);
      });

      difficultySelect.addEventListener("change", () => {
        selectedDifficulty = difficultySelect.value;
      });


      function startCountdown(onFinish) {
        let t = 3;
        countdownEl.textContent = t;
        countdownEl.style.display = "block";
        menuOverlay.style.opacity = "0";
        menuOverlay.style.pointerEvents = "none";

        const i = setInterval(() => {
          t--;
          if (t > 0) countdownEl.textContent = t;
          else {
            clearInterval(i);
            countdownEl.style.display = "none";
            onFinish();
          }
        }, 1000);
      }

      window.selectMode = (mode) => {
        activeMode = mode;
        startCountdown(() => {
          isGameActive = true;
          window.startGame(mode, selectedTime, selectedDifficulty);
        });
      };

      window.onGamePause = () => {
        if (isGameActive && !isPaused) {
          isPaused = true;
          pauseOverlay.style.display = "flex";
          window.setGamePaused(true);
        }
      };

      btnResume.addEventListener("click", () => {
        isPaused = false;
        pauseOverlay.style.display = "none";
        document.getElementById("webgl").requestPointerLock();
        window.setGamePaused(false);
      });

      btnRestart.addEventListener("click", () => {
        isPaused = false;
        pauseOverlay.style.display = "none";
        startCountdown(() => window.startGame(activeMode, selectedTime, selectedDifficulty));
      });

      btnExit.addEventListener("click", () => location.reload());
    </script>
  </body>
</html>
